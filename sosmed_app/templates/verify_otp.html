<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verifikasi OTP</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='auth-styles.css') }}">
</head>
<body class="auth-page">
  <div class="auth-container">
    <h2>Verifikasi OTP</h2>
    {% if error %}<p class="error">{{ error }}</p>{% endif %}
    <form method="POST">
      <div class="form-group">
        <input type="text" 
       name="otp" 
       placeholder="Masukkan OTP" 
       required 
       maxlength="6" 
       pattern="[0-9]{6}" 
       inputmode="numeric"
       oninput="this.value=this.value.replace(/[^0-9]/g,'')" />
      </div>
      <button type="submit">Verifikasi</button>
    </form>
    
    <div id="resend-container">
      <p>Tidak menerima kode? <span id="countdown">60</span> detik</p>
      <button id="resend-btn" style="display: none;" onclick="resendOTP()">Kirim Ulang OTP</button>
    </div>
  </div>

  <script>
    let timeLeft = 60;
    const countdownElement = document.getElementById('countdown');
    const resendBtn = document.getElementById('resend-btn');

    // Timer countdown
    const countdown = setInterval(() => {
      timeLeft--;
      countdownElement.textContent = timeLeft;
      
      if (timeLeft <= 0) {
        clearInterval(countdown);
        countdownElement.style.display = 'none';
        resendBtn.style.display = 'inline';
      }
    }, 1000);

    // Fungsi untuk kirim ulang OTP
    function resendOTP() {
      fetch('/resend-otp', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => {
        if (response.ok) {
          alert('OTP berhasil dikirim ulang!');
          // Reset timer
          timeLeft = 60;
          countdownElement.textContent = timeLeft;
          countdownElement.style.display = 'inline';
          resendBtn.style.display = 'none';
          
          // Jalankan ulang timer
          const newCountdown = setInterval(() => {
            timeLeft--;
            countdownElement.textContent = timeLeft;
            
            if (timeLeft <= 0) {
              clearInterval(newCountdown);
              countdownElement.style.display = 'none';
              resendBtn.style.display = 'inline';
            }
          }, 1000);
        } else {
          alert('Gagal mengirim ulang OTP. Silakan coba lagi.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Terjadi kesalahan. Silakan coba lagi.');
      });
    }
  </script>
</body>
</html>